(function(){jQuery(function(){var e,t,n,a,i,r,c,o,l,u,p,s,d,g,f,v;return c=!1,v=function(e){var t,n,a,i,r,c,o,l,u;return t=new Date(1e3*e),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=t.getFullYear(),r=c[t.getMonth()],n=t.getDate(),a=t.getHours(),i=t.getMinutes(),o=t.getSeconds(),l=n+". "+r+" "+u+" "+a+":"+i+":"+o},l=function(){var e;return e=web3.db.getString("etherstarter","campaigns"),""===e?[]:JSON.parse(e)},t=function(e){var t;return t=l(),t.push(e),web3.db.putString("etherstarter","campaigns",JSON.stringify(t))},f=function(){return d.watch({topic:[web3.fromAscii("etherstarter"),web3.fromAscii(a),web3.fromAscii("announce-campaign")]}).arrived(function(e){var n;return n=JSON.parse(web3.toAscii(e.payload)),t(n)})},s=function(e,t,n){var i;return i=web3.fromAscii(JSON.stringify({id:e,title:t,description:n})),d.post({topic:[web3.fromAscii("etherstarter"),web3.fromAscii(a),web3.fromAscii("announce-campaign")],payload:i,ttl:600})},d=web3.shh,a=web3.db.get("etherstarter","contract"),e=JSON.parse(web3.db.getString("etherstarter","abi")),i=web3.eth.contract(a,e),f(),$("body.home").length>0&&(u=function(){return $("select#campaigns")},r=function(){return u().val()},g=function(e){var t,n,a,r,c,o,p,s;return t=$.grep(l(),function(t){return t.id===e}),t=t[0],u().val(e),$(".title h1").text(t.title),$(".description .inner").text(t.description),$(".description").show(),s=i.call().get_recipient(e),$(".pledge").show(),$(".campaign").show(),c=i.call().get_goal(e),a=i.call().get_deadline(e),p=i.call().get_total(e),$(".raised .value span").text(p),$(".total span").text(c),$(".recipient_address span").text(i.call().get_recipient(e)),o=p/c*100,$(".bar .inner").width(""+o+"%"),$(".info .percent").text(""+Math.round(o)+"%"),r=a-Date.now()/1e3,r>0?(n=Math.round(r/86400),$(".info .time_left").text(""+n+" days left")):$(".info .time_left").text("campaign ended"),$(".notice span").text(v(a))},$(".pledge button").on("click",function(e){var t,n,a;return n=r(),t=+$(".amount input").val(),i.value(t).contribute(n),g(n),a=i.call().get_total(n),$(".raised .value span").text(a),$(".amount input").val("")}),n=l(),$.each(n,function(e,t){return 0===e&&g(t.id),u().append($("<option/>",{value:t.id,text:t.title}))}),u().on("change",function(e){return g(r())}),p=Url.queryString("campaign_id"),p&&g(p)),$("body.admin").length>0?(c&&($("#create_campaign").show(),$("#title").val("Title"),$("#description").val("Description"),$("#goal").val("500"),$("#duration").val("10"),$("#recipient").val("dedc82cb364f93ddec1bf323069951b91c75c591")),o=$("#create_campaign form"),o.on("submit",function(e){var t,n,a,r,c,l;return e.preventDefault(),l=o.find("#title").val(),n=o.find("#description").val(),a=+o.find("#goal").val(),t=Date.now()/1e3+24*+o.find("#duration").val()*60*60,r="0x"+o.find("#recipient").val(),p=i.call().get_free_id(),c=i.transact().create_campaign(p,r,a,t,0,0),s(p,l,n),o.find("input[type=text], textarea").val(""),"1"!==Url.queryString("create")&&($("#create_campaign").hide(),$("#create_new_campaign").show()),alert("CREATED")}),$("#create_campaign a#close").on("click",function(e){return e.preventDefault(),$("#create_campaign").hide(),$("#create_new_campaign").show()}),$("#create_new_campaign").on("click",function(e){return e.preventDefault(),$(this).hide(),$("#create_campaign").fadeIn(),o.find("#title").focus()})):void 0})}).call(this);