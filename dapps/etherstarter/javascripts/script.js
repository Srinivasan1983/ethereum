(function(){jQuery(function(){var t,e,n,i,a,r,c,o,l,u,s,d,p,g,f,m,v;return c=!1,v=require("web3"),v.setProvider(new v.providers.HttpSyncProvider("http://localhost:8080")),m=function(t){var e,n,i,a,r,c,o,l,u;return e=new Date(1e3*t),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=e.getFullYear(),r=c[e.getMonth()],n=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),l=n+". "+r+" "+u+" "+i+":"+a+":"+o},l=function(){var t;return t=v.db.getString("etherstarter","campaigns"),""===t?[]:JSON.parse(t)},e=function(t){var e;return e=l(),e.push(t),v.db.putString("etherstarter","campaigns",JSON.stringify(e))},f=function(){return p.watch({topic:[v.fromAscii("etherstarter"),v.fromAscii(i),v.fromAscii("announce-campaign")]}).arrived(function(t){var n;return n=JSON.parse(v.toAscii(t.payload)),e(n)})},d=function(t,e,n){var a;return a=v.fromAscii(JSON.stringify({id:t,title:e,description:n})),p.post({topic:[v.fromAscii("etherstarter"),v.fromAscii(i),v.fromAscii("announce-campaign")],payload:a,ttl:600})},p=v.shh,i=v.db.get("etherstarter","contract"),t=JSON.parse(v.db.getString("etherstarter","abi")),a=v.eth.contract(i,t),f(),$("body.home").length>0&&(u=function(){return $("select#campaigns")},r=function(){return u().val()},g=function(t){var e,n,i,r,c,o,s,d;return e=$.grep(l(),function(e){return e.id===t}),e=e[0],u().val(t),$(".title h1").text(e.title),$(".description .inner").text(e.description),$(".description").show(),d=a.call().get_recipient(t),$(".pledge").show(),$(".campaign").show(),c=a.call().get_goal(t),i=a.call().get_deadline(t),s=a.call().get_total(t),$(".raised .value span").text(s),$(".total span").text(c),$(".recipient_address span").text(a.call().get_recipient(t)),o=s/c*100,$(".bar .inner").width(""+o+"%"),$(".info .percent").text(""+Math.round(o)+"%"),r=i-Date.now()/1e3,r>0?(n=Math.round(r/86400),$(".info .time_left").text(""+n+" days left")):$(".info .time_left").text("campaign ended"),$(".notice span").text(m(i))},$(".pledge button").on("click",function(t){var e,n,i;return n=r(),e=+$(".amount input").val(),a.value(e).contribute(n),g(n),i=a.call().get_total(n),$(".raised .value span").text(i),$(".amount input").val("")}),n=l(),$.each(n,function(t,e){return 0===t&&g(e.id),u().append($("<option/>",{value:e.id,text:e.title}))}),u().on("change",function(t){return g(r())}),s=Url.queryString("campaign_id"),s&&g(s)),$("body.admin").length>0?(c&&($("#create_campaign").show(),$("#title").val("Title"),$("#description").val("Description"),$("#goal").val("500"),$("#duration").val("10"),$("#recipient").val("dedc82cb364f93ddec1bf323069951b91c75c591")),o=$("#create_campaign form"),o.on("submit",function(t){var e,n,i,r,c,l,u,p,g,f;return t.preventDefault(),f=o.find("#title").val(),n=o.find("#description").val(),i=+o.find("#goal").val(),e=Date.now()/1e3+24*+o.find("#duration").val()*60*60,l="0x"+o.find("#recipient").val(),p=v.shh.newIdentity(),g=new BigNumber(p.substring(2),16),r=g.modulo(new BigNumber(2).toPower(256)),c=g.minus(r).dividedBy(new BigNumber(2).toPower(256)),s=a.call().get_free_id(),u=a.transact().create_campaign(s,l,i,e,r,c),d(s,f,n),o.find("input[type=text], textarea").val(""),"1"!==Url.queryString("create")&&($("#create_campaign").hide(),$("#create_new_campaign").show()),alert("CREATED")}),$("#create_campaign a#close").on("click",function(t){return t.preventDefault(),$("#create_campaign").hide(),$("#create_new_campaign").show()}),$("#create_new_campaign").on("click",function(t){return t.preventDefault(),$(this).hide(),$("#create_campaign").fadeIn(),o.find("#title").focus()})):void 0})}).call(this);